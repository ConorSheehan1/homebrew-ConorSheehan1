# Dev
### committing
ensure the readme is up to date.
use `bundle exec ruby scripts/generate_readme_table.rb` to generate the readme table.

### Tagging convention
major version tbd
minor version when adding new tool
patch version when fixing tool / installation

### python install
Formula scaffold using [poet](https://github.com/tdsmith/homebrew-pypi-poet)
```bash
poetry install
poetry run poet -f $package
```

```bash
# example
poetry shell
cd ../../shot
poetry run build
poetry install
cd - # back to scripts dir
poetry run poet -f shot
# note $package doesn't need to be on pypi, just installed in current python environment.
# name sha etc will be wrong if not on pypi, but deps will be correct
```

#### shot notes
release 2.0.0 didn't work for a few reasons.
1. dataclasses was included in deps generated by poet, even though the package is only required for python <= 3.6.  
    similar to: https://github.com/pytorch/pytorch/issues/46930#issue-730689742  
    resolved by removing dataclasses from shot.rb
2. `brew reinstall shot` failed because I was still using poetry build system instal of poetry-core.  
    see: https://github.com/python-poetry/poetry/issues/3661#issuecomment-808863153  
    resolved by changing to poetry-core build system and releasing 2.0.1  
    https://github.com/ConorSheehan1/shot/releases/tag/v2.0.1

### ruby install
Tests and linting
```bash
bundle install
bundle exec rubocop # --safe-auto-correct
bundle exec rspec
# note: can't use parallel_tests.
# Error: Another active Homebrew update process is already in progress.
```

### debugging formula locally
1. [edit the formula](https://github.com/Homebrew/brew/issues/1505#issuecomment-260575386)
    ```bash
    brew edit $formula
    # e.g. brew edit shot, copy contents from ./shot.rb to shell
    ```

2. [install and run byebug](https://discourse.brew.sh/t/debugging-homebrew-using-pry-byebug/3234/4) at the point causing issues
    ```ruby
    def install
        Homebrew.install_gem_setup_path! "byebug"
        require 'byebug'
        byebug
        venv = virtualenv_create(libexec)
        venv.pip_install resources
    end
    ```

3. reinstall
    ```bash
    brew reinstall $formula
    # e.g. brew reinstall shot
    ```

Additional info at https://docs.brew.sh/Python-for-Formula-Authors

